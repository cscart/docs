******
4.12.1
******

==================================
Новая функциональность и улучшения
==================================

[+] Дизайн: Макеты: Для главной страницы, а также страниц товара и категории добавлена возможность перемещать блоки на витрине.

[+] Дизайн: Модули: Все добавляемые модулем пункты меню теперь также отображаются в "шестерёнке" на списке модулей.

[+] Дизайн: Модули: В меню "Модули" и в боковую панель на списке модулей добавлен список разработчиков модулей.

[+] Доставка и налоги: Регионы: На страницу списка регионов в панели администратора добавлено контекстное меню.

[+] Иконка сайта: Для иконки сайта добавлена поддержка экранов Retina.

[+] Модули: CommerceML [Beta]: Обновлены настройки; добавлена передача заказов и интеграция со складами.

[+] Модули: Google reCAPTCHA: Добавлена поддержка невидимого Google reCAPTCHA v3.

[+] Модули: Вариации товаров: Добавлена настройка, позволяющая отобразить все возможные варианты характеристик товара в карточке товара и в списке товаров.

[+] Модули: Возврат товаров: Добавлена возможность управлять уведомлениями о возвратах в меню "Администрирование > Уведомления".

[+] Модули: В схеме модуля добавлена возможность указывать страницу разработчика.

[+] Модули: Отзывы и комментарии: Добавлена возможность настраивать получателей уведомлений о новых отзывах в меню "Администрирование > Уведомления".

[+] Модули: Прикрепленные файлы: Экспорт/импорт: Добавлен экспорт/импорт прикреплённых файлов.

[+] Модули: Яндекс.Метрика: Добавлена возможность использовать Вебвизор 2.0.

[+] Настройки: Иконки: Теперь вы можете изменить размер иконки вариантов товара.

[+] Настройки: Оформление заказа: Добавлена настройка, позволяющая отображать на странице оформления заказа способы доставки, недоступные для указанного адреса.

[+] Опции: Добавлена возможность выбрать применяемые к товарам опции на списке опций.

[+] Поля профиля: Добавлен новый тип поля "Файл", чтобы пользователи могли при регистрации или в профиле загружать различные файлы.

[+] Покупатели: На список покупателей добавлено контекстное меню с действиями, которое появляется при выделении хотя бы одного покупателя.

[+] Привилегии: Теперь можно точнее настроить, какие действия администратор может совершать с заказом.

[+] Промо-акции и скидки: На списке промо-акций и скидок в панели администратора добавлено контекстное меню с действиями, которое появляется при выделении хотя бы одной промо-акции.

[+] Способы доставки: Оформление заказа: На странице оформления заказа добавлена подсветка способов доставки при перерасчёте их стоимости.

[+] Способы доставки: Теперь вы можете отключить способы доставки с расчётом в реальном времени для некоторых тарифных зон.

[+] Тарифные зоны: На страницу списка тарифных зон было добавлено контекстное меню.

[+] Темы: Логотипы: На страницу редактирования тем добавлена секция для редактирования логотипов.

[+] Товары: Опции: Добавлено быстрое создание опции со страницы редактирования товара.

[+] Товары: Характеристики: Добавлено быстрое создание характеристики со страницы редактирования товара.

[+] Уведомления: Добавлена возможность выбирать получателей для разных типов уведомлений.

[+] Характеристики: В панель администратора добавлено новое поле для внутреннего имени характеристики. Это позволит удобнее работать с разными характеристиками, которые должны называться одинаково на витрине.

[+] Ядро: Библиотека Twig была обновлена до версии 1.42.5.

[+] Multi-Vendor: Логотипы: Продавцы: Теперь вы можете задать логотип по умолчанию для новых продавцов.

[+] Multi-Vendor: Модули: Блог: Добавлен блок, который отображает только посты продавца.

[+] Multi-Vendor: Модули: Модуль "Оплата долгов продавцов" заменён на новый модуль "Оплата от продавцов администратору". Он позволяет точнее настроить, кого считать должником и что делать с должниками.

[+] Multi-Vendor: Модули: Тарифные планы для продавцов: Добавлена возможность быстрого создания тарифного плана на странице редактирования продавца.

[+] Multi-Vendor: Налоги: Добавлена настройка, при включении которой налог, который должен уплатить продавец, переходит на счет маркетплейса. Это нужно для стран, где налоги требуют с маркетплейса, а не непосредственно с продавца.

[+] Multi-Vendor: Настройки: Продавцы: Добавлена возможность выбрать процесс одобрения продавцов: в 1 шаг или в 2 шага.

[+] Multi-Vendor: Отзывы и комментарии: Добавлена возможность для продавца просматривать все комментарии и отзывы с одной страницы.

[+] Multi-Vendor: Теперь нижняя панель отображается для авторизованных продавцов, чтобы им было проще найти панель администратора.

[+] Multi-Vendor: Расширенный импорт товаров: Добавлена возможность создавать общие пресеты для импорта товаров.

[+] Multi-Vendor: Характеристки: Теперь можно разрешить продавцам создавать свои характеристики.

[+] Multi-Vendor Plus: Модули: Возврат товаров: Теперь можно разрешить продавцам управлять возвратами.

[+] Multi-Vendor Plus: Модули: Привилегии продавцов: Теперь можно разрешить продавцам полноценно создавать и редактировать заказы.

[+] Multi-Vendor Plus: Модули: Рейтинг продавцов: Добавлен новый модуль для ранжирования продавцов и сортировки по рейтингу.

[+] Multi-Vendor Ultimate: Добавлена возможность задавать разные настройки (в т.ч. у некоторых модулей) для разных витрин.

[+] Multi-Vendor Ultimate: Модули: Вход через соцсети: Теперь для каждой социальной сети можно решить, на какой витрине доступен вход через неё.

=========================================
Изменения в существующей функциональности
=========================================

[*] Дизайн: Мобильный вид: Был обновлен выбор витрин на мобильных устройствах.

[*] Дизайн: Теперь модулям запрещено создание новых корневых элементов в верхних меню панели администратора. Эта возможность включается или выключается через конфигурационный файл.

[*] Дизайн: Панель администратора: Подсказки: Теперь большинство подсказок по умолчанию отображаются под тем, что они описывают. Не нужно наводить мышь на знак вопроса, чтобы увидеть подсказку.

[*] Дизайн: Размер полей с галками был увеличен.

[*] Модули: HiDPI: Устаревшая логика восстановления изображений (нужная только для старых версий) была вырезана.

[*] Модули: SEO: Код языка витрины по умолчанию больше не будет отображаться в URL при включенной настройке "Отображать язык в URL".

[*] Модули: Вариации товаров: Вариация по умолчанию теперь изменяется не только когда ее кол-во на складе кончается, но также когда ее статус меняется на "Выкл" или "Скрыто".

[*] Модули: Вариации товаров: Улучшен интерфейс добавления вариаций.

[*] Модули: Увеличенные изображения товаров: Упрощены настройки модуля.

[*] Настройки: Быстрый старт: Настройка "Показывать меню при наведении курсора" удалена. Теперь по умолчанию меню "Быстрый старт" открывается при наведении курсора.

[*] Оформление заказа: Выбор города был улучшен.

[*] Паждинация: Теперь ссылка на страницу с результатами фильтрации, на которых заведомо нет товаров (например, ссылка на страницу #5, когда есть всего 3 страницы с результатами) показывает "Страница не найдена".

[*] Панель администратора: Дизайн: Теперь автозаполнение отключено для всех полей в панели администратора.

[*] Панель администратора: Уведомления: Интерфейс для управления уведомлениями был улучшен.

[*] Промо-акции: Настройка "Не применять другие промо-акции" теперь отменяет не только те промо-акции, что ниже по приоритету.

[*] Промо-акции: Реализована возможность добавлять картинки для промо-акций.

[*] Способы доставки: Интерфейс настроек тарифов и тарифных зон был обновлён.

[*] Статусы заказа: В статусы заказа добавлен новый параметр «Считать заказ оплаченным». Только заказ с этим параметром будет рассматриваться в статистике как оплаченный заказ.

[*] Товары: В боковую панель поиска был добавлена возможность найти категорию или вводом её названия, или через дерево категорий.

[*] Товары: Комбинации опций: Функциональность убрана; её роль теперь выполняют вариации товаров.

[*] Модули: Бонусные баллы: Теперь настройки цены в баллах и количества баллов, заработанных за товар, на уровне товара могут наследовать значения из настроек модуля.

[*] Фильтры: Теперь на витрине удобнее выбрать сразу несколько критериев фильтрации товаров.

[*] Фильтры: Улучшена производительность фильтрации товаров на витрине.

[*] Характеристики: Обновлена вкладка "Характеристики" на странице редактирования товара.

[*] Ядро: Единый файл с функциями fn.catalog.php теперь разбит на раздельные файлы по предметным областям.

[*] Ядро: Контроллер xml_feeds был удален.

[*] CS-Cart: Список языков и валют, доступных на витрине, добавлен на страницу редактирования витрины.

[*] Multi-Vendor: Модули: Pickpoint: Настройки учетной записи Pickpoint перенесены в свойства способа доставки, чтобы их могли задать продавцы.

[*] Multi-Vendor: Модули: Почта России: Настройки бланков Почты России перенесены в свойства способа доставки, чтобы с ними могли работать продавцы.

[*] Multi-Vendor: Модули: Тарифные планы для продавцов: Теперь список планов на витрине перенаправляет на страницу регистрации продавца, если не доступен ни один тарифный план.

[*] Multi-Vendor: Модули: Тарифные планы продавцов: Улучшены механизмы для добавления и исключения категорий из тарифного плана.

[*] Multi-Vendor Plus: Модули: Общие товары для продавцов: Добавлено массовое редактирование общих товаров для администратора.

==================
Исправления ошибок
==================


[!] Multi-Vendor: Дизайн: Блоки: Продавцы: Значение настройки "Показать количество товаров" блока "Продавцы" игнорировалось во время выборки данных для этого блока. Это могло негативно влиять на производительность. Исправлено.

[!] Multi-Vendor: Категории: Продавцы: Если категорий было много, то в панели администратора не раскрывался список вложенных категорий. Исправлено.

[!] Multi-Vendor: Кнопка "Панель управления" в разделе "Мой профиль" на витрине могла быть скрытой для продавцов. Исправлено.

[!] Multi-Vendor: Модули: Режим каталога: Ссылка "Купить сейчас" открывалась в том же окне, из-за чего покупателям было сложнее вернуться на маркетплейс. Исправлено.

[!] Multi-Vendor: Модули: Бонусные баллы: Промо-акции и скидки: По промо-акции можно было несколько раз получить бонусные баллы за один заказ. Исправлено.

[!] Multi-Vendor: Модули: Выплата долгов продавцов: Товары: После изменения или создания товара могла возникнуть ошибка PHP Notice. Исправлено.

[!] Multi-Vendor: Модули: Местоположение продавцов: Нельзя было очистить поле "Местоположение" на странице редактирования продавца. Исправлено.

[!] Multi-Vendor: Модули: Премодерация данных продавцов: Изменения в пользовательских полях профиля не учитывались при решении, отправлять ли продавца на модерацию. Исправлено.

[!] Multi-Vendor: Модули: Премодерация данных продавцов: Отклоненные товары нельзя было отправить на модерацию, если проверка изменённых товаров была отключена. Исправлено.

[!] Multi-Vendor: Модули: Тарифные планы для продавцов: Оплата от продавцов администратору: Сумма долга считалась некорректно, если продавец не внес оплату за план, но у него был положительный баланс. Исправлено.

[!] Multi-Vendor: Оформление заказа: Промо-акции: Промо-акция для каталога могла применяться неверно при заказе от двух продавцов. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Данные товарного предложения не обновлялись при обновлении общего товара, если товарного предложения не было в наличии. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Не было возможности создать общий товар через импорт. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Товарное предложение не отображалось в списке товаров, если у вариации по умолчанию нулевое количество, а другая вариация была в наличии. Исправлено

[!] Multi-Vendor Ultimate: Модули: SEO: Вариации товаров: Общие товары для продавцов: Когда администратор выбирал другую витрину в панели администратора, в некоторых случаях могла возникнуть ошибка PHP Notice. Исправлено.

[!] Блоки:  В панели администратора у секции не сохранялась выбранная оболочка "Простое оформление заказа". Исправлено.

[!] Дизайн: В витрине мобильной версии имелись небольшие проблемы дизайна. Исправлено.

[!] Дизайн: Возникали ошибки валидации на детальной странице товара, категории. Исправлено.

[!] Дизайн: Всплывающие окна: Некоторые окна имели заголовок "undefined". Исправлено.

[!] Дизайн: Панель администратора: На небольших экранах не отображалась кнопка переключения витрин. Исправлено.

[!] Заказы: Незавершенные покупки: Данные покупателя могли не отображаться, если он был зарегистрирован, но не вошёл в учётную запись. Исправлено.

[!] Заказы: Незавершенные покупки: На странице незавершенных покупок отображалась ссылка на детальную страницу пользователся для незарегестрированного пользователя. Исправлено.

[!] Изображения: В запросе к базе данных использовался некорректный плейсхолдер; из-за этого в некоторых случаях могла страдать производительность. Исправлено.

[!] Импорт/экспорт: При мультивитринности в файле экспорта могли выгружаться неверные URL изображений и товаров. Исправлено.

[!] Категории: На списке категорий в панели администратора не выделялись подкатегории. Исправлено.

[!] Кэш: Меню: Кэш для блоков меню был неконтролируемым, что приводило к росту  файлов кэша. Исправлено.

[!] Мини-иконки: При медленном интернете анимация загрузки мини-иконок располагалась не по центру. Исправлено.

[!] Модули: CommerceML: На странице настройки синхронизации использовались некорректные ссылки на документацию. Исправлено.

[!] Модули: CommerceML: При импорте из системы учета вариации всегда создавались как один товар, независимо от цели характеристики, на основании которой были созданы. Исправлено.

[!] Модули: Email-маркетинг: Возникала ошибка при переустановке модуля. Исправлено.

[!] Модули: Email-маркетинг: Флажок для подписки на рассылку появлялся только после выбора способа доставки или оплаты. Если способ доставки или оплаты был один, то флажок для подписки не появлялся. Исправлено.

[!] Модули: SEO: 301 редиректы: Имя выбранного товара отображалось неверно. Исправлено.

[!] Модули: SEO: Изменение названия страницы и мета-описания не влияло на предпросмотр Google Rich Snippets. Исправлено.

[!] Модули: SEO: Операция по изменению SEO-имени в некоторых случаях неправильно оповещала о своем результате. Исправлено.

[!] Модули: Вариации товаров: Дизайн: В панели администратора таблица со списком вариаций выходила за границы экрана, если у товара было длинное наименование. Исправлено.

[!] Модули: Вариации товаров: Дочерние вариации товара могли отображаться в поиске и при фильтрации, даже если вариация по умолчанию отключена. Исправлено.

[!] Модули: Вариации товаров: Массовое редактирование: Изображения: При смене главного изображения одной вариации, изображения менялись у всех вариаций. Исправлено.

[!] Модули: Водяные знаки: Некоторые изображения в панели администратора не отображались. Исправлено.

[!] Модули: Возврат товаров: Склады [Beta]: Если в запросе на возврат были товары, у которых количество разделено по складам, то во время обработки заявки на возврат товара возникали ошибки PHP Notice. Исправлено.

[!] Модули: Зависимости для способов оплаты: Когда был включен модуль "Зависимости оплаты", то способы оплаты, не принадлежащие витрине, не были на ней доступны, даже если их доступность для этой витрины была настроена. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Не работал поиск пунктов самовывоза, если был выключен модуль "Карты и геолокация". Исправлено.

[!] Модули: Мобильное приложение: Возникала PHP-ошибка, если файл переводов был некорректно сформирован. Исправлено.

[!] Модули: Не устанавливались переводы для модулей, которые скрыты в панели администратора. Исправлено.

[!] Модули: Отзывы и комментарии: Google ReCAPTCHA: Если в диалоговом окне отзывов и комментариев была reCAPTCHA, то появлялась полоса прокрутки, а страница не прокручивалась. Исправлено.

[!] Модули: Отзывы и комментарии: Возникала ошибка при сохранении отзыва с некорректным форматом времени. Исправлено.

[!] Модули: Отзывы и комментарии: Фокусная рамка флажка была обрезана в посте. Исправлено.

[!] Модули: Почта России: Города: Отсутствовал почтовый индекс населенного пункта Совхоз имени Ленина, Московская область. Исправлено.

[!] Модули: Рассылки: Могла произойти ошибка при отправке рассылки, если она одновременно отправлялась по списку рассылки и определённым пользователям. Исправлено.

[!] Модули: СДЭК: Способ доставки был недоступен для товара с бесплатной доставкой, если вес товара был в граммах. Исправлено.

[!] Модули: Склады [Beta]: Сохранение настроек склада могло занять продолжительное время из-за дублирующих запросов к базе данных. Исправлено.

[!] Модули: Центр сообщений: Добавлена возможность продавцов общаться с администратором.

[!] Модули: Экспорт в Яндекс.Маркет: При смене основной категории у товара она не изменялась в прайс-листе, если товар не принадлежал витрине, для которой выгружается прайс-лист. Проблема была актуальна только при наличии нескольких витрин, и если разрешен "Экспорт общих товаров" в прайс-лист. Исправлено.

[!] Оформление заказа: Если покупатель использовал только пробелы в обязательных полях, то он всё ещё мог разместить заказ. Исправлено.

[!] Оформление заказа: Не работал выбор профиля на странице оформления заказа, также, в заказе мог сохранятся не тот штат, который был выбран покупателем. Исправлено.

[!] Оформление заказа: При загрузке страницы можно было разместить заказ, даже если обязательные поля не были заполнены. Исправлено.

[!] Панель администратора: Валюты: При изменении кода валюты терялось её название у всех языков. Исправлено.
 
[!] Панель администратора: Не менялся язык контента на мобильных устройствах при переключении языка интерфейса. Исправлено.

[!] Панель администратора: Поиск: На панели инструментов не работал поиск на мобильных устройствах. Исправлено.

[!] Производительность: JS: "Центр уведомлений" мог значительно замедлить загрузку страниц панели администратора при медленном интернет-соеднении. Исправлено.

[!] Способы доставки: При изменении адреса доставки сбрасывались введеные данные оплаты. Исправлено.

[!] Способы оплаты: Секретный ключ мог автоматически заполняться неверными данными через автозаполнение браузера. Исправлено.

[!] Товары: Если у товара было много изображений (на две или более строк), то в панели администратора на странице редактирования товара обрезалось меню выбора изображений. Исправлено.

[!] Товары: Категории: Если в панели администратора менялось количество отображаемых товаров на странице списка, то изменение категории товара через контекстное меню не работало. Исправлено.

[!] Товары: Не сохранялись категории, созданные при массовом редактировании товаров. Исправлено.

[!] Товары: Фильтры: Если выбранный вариант фильтра не выдал товары, то этот фильтр блокировался. Исправлено.

[!] Товары: Характеристики: Если при переименовании варианта характеристики его новое имя совпадало с одним из существующих, то все данные варианта удалялись. Исправлено.

[!] Товары: Характеристики: Новые варианты с типом фильтра «Цвет» не сохраняли цвет по умолчанию. Исправлено.

[!] Уведомления: Поле, располагающееся под уведомлением, было некликабельным. Исправлено.

[!] Файлы: Начальное положение окна файлового менеджера было неправильным. Исправлено.

[!] Файлы: Отсутствовали файлы локализации файлового менеджера. Исправлено.

[!] Файлы: Окно предпросмотра изображений отображалось с ошибками. Исправлено.

[!] Центр обновлений: У некоторых обновлений могло не появляться уведомление об изменениях при повторной установке после восстановления из резервной копии. Исправлено.

[!] Центр уведомлений: Изменение статуса внутренних шаблонов приводило к ошибке БД. Исправлено.

[!] Экспорт/Импорт: Товары: При экспорте изображений, оптовых скидок и исключений комбинаций опций не учитывалось, какие товары были выбраны для экспорта. Исправлено.

[!] Электронная почта: Логотипы: Ссылка с логотипа вела не на витрину. Исправлено.

[!] Ядро: JavaScript: События в старом стиле data-ca-event="ce.eventname" не работали. Исправлено.

[!] Ядро: Библиотеки: Js: Была обновлена библиотека Moment.js до версии 2.27.0.

[!] Ядро: Телефон: Недоступный код страны можно было ввести в поле телефона. Исправлено.

[!] Ядро: Установщик: При использовании PHP 7.4, в процессе установки возникали ошибки PHP Notice. Исправлено.

[!] REST API: Stores: Orders: API-запрос на создание заказа, выполненный из-под главного администратора, возвращал ошибку 403. Исправлено.

[!] WYSIWYG: При добавлении изображения в описание товара с использованием редактора TinyMCE возникала ошибка. Исправлено.